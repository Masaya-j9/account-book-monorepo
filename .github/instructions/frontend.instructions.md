---
applyTo: "apps/frontend/**"
---
# GitHub Copilot Instructions（フロントエンド）

## 言語設定

- すべてのレビューコメントとフィードバックは**日本語**で記述してください
- コードコメントの提案も日本語で行ってください
- 技術用語は適切に日本語化し、必要に応じて英語表記を併記してください

## Pull Request 作成時の言語

- copilot-agent によって pull request を生成する場合、タイトル・説明・変更点・テスト結果などすべて日本語で記述してください。
- 体裁は普通のチーム向け PR と同じにして、要点がすぐに分かる構成（目的/変更/テスト/注意点）にして、英語を使う場面があれば括弧付きで補足してください。

## レビュー方針

### コード品質

- TypeScript/JavaScript のベストプラクティスに従っているか確認
- 型安全性が確保されているか確認
- エラーハンドリングが適切に実装されているか確認
- 未使用の変数やインポートがないか確認

### パフォーマンス

- 不要な再レンダリングがないか（React）
- 非効率なループや処理がないか
- メモリリークの可能性がないか

### セキュリティ

- 機密情報のハードコーディングがないか
- SQL インジェクションや XSS の脆弱性がないか
- 適切な認証・認可が実装されているか

### テスト

- 新機能に対するテストケースが追加されているか
- エッジケースのテストが含まれているか
- テストカバレッジが適切か

#### テスト記述ルール

- Vitest の `describe` / `it` の説明文は日本語で記述する（例: "〜できる", "〜の場合は例外になる"）
- テストは原則として `describe("正常系")` / `describe("異常系")` を挟み、意図が分かるように分類する
- テスト内の一時変数の初期値として `null` は使用しない（未設定は `undefined` を使う）。※ 型/仕様として `null` が必須な入出力（例: DBの nullable 列、DTO）を除く

### ドキュメント

- 複雑なロジックにコメントが付いているか
- 公開 API やコンポーネントにドキュメントがあるか
- README の更新が必要な場合は指摘

## プロジェクト固有のルール（フロントエンド）

### 対象

- `apps/frontend`: Next.js 15 + React 19

### コーディング規約

- Biome を使用した Lint と Format
- Vitest を使用したテスト
- Turborepo を使用したビルド管理

### Hooks / Next.js ガードレール

- Hooks はコンポーネント直下またはカスタムフック直下でのみ呼び出す（条件分岐・ループ・ネスト関数内で呼ばない）
- クライアント専用フック（`useState`, `useEffect`, `useMemo`, `useCallback`, `useRef`, `useRouter` など）を使うコンポーネントには先頭に `"use client"` を付与する
- `"use client"` は必要最小限に留める（原則は Server Components）
- データ取得は可能な限り Server Components / Server Actions で行う（`useEffect` でのフェッチは最小限）
- `useEffect` は副作用に限定し、派生データの計算には使わない（`useMemo` か単純計算で表現）
- `useEffect` の依存配列は省略しない（必要なら `useCallback` / `useMemo` で依存の安定化を行う）
- `useMemo` / `useCallback` はパフォーマンス根拠がある場合のみ使用する（過剰最適化を避ける）
- `useState` 初期値で高コスト計算が必要な場合は遅延初期化を使う（関数渡し）
- タイマー・購読・イベントリスナーは `useEffect` のクリーンアップで必ず解除する
- 参照 ID の生成は `useId` を使い、レンダリング毎の乱数生成は避ける
- 状態として持つ必要がない可変値は `useRef` を使う
- カスタムフック名は `use` から始め、責務単位で分割する

### Next.js 準拠ガイド（Learn に準拠）

- ルーティングは App Router を前提に設計し、`app/` 配下の `layout.tsx` / `page.tsx` を基本単位とする
- 共有 UI は `layout.tsx` に寄せ、ページ間で共通化できる構造にする
- 画面遷移は `<Link>` を使い、`<a>` の直接利用は避ける
- 画像は `next/image`、フォントは `next/font` を優先して最適化する
- データ取得は Server Components / Server Actions を優先し、クライアント側のフェッチは最小限に抑える
- 静的/動的レンダリングの特性を踏まえ、必要に応じてキャッシュ・再検証を設計する
- 体感速度改善のため、`loading.tsx` / streaming を活用して段階的に表示する
- 検索・ページネーションは Next.js のルーティング機能と組み合わせて実装する
- 例外処理は `error.tsx` / `not-found.tsx` を使い、ページ単位でハンドリングする
- アクセシビリティはフォームのバリデーションと合わせて担保する（エラーメッセージの紐付けなど）
- 認証が必要な画面は Server Actions も活用して保護する
- メタデータは `metadata` / `generateMetadata` で管理し、SEO を考慮する

### React ベストプラクティス（Vercel 指針を参考）

- 最初に「待ち時間の削減」と「バンドルサイズ削減」を優先する（順序付けを徹底）
- 依存関係のない非同期処理は並列化し、不要なウォーターフォールを避ける
- クライアントへ送る JS を最小化する（不要な依存・重いライブラリの持ち込みを避ける）
- サーバー側でできる処理はサーバー側で完結させ、クライアントの負荷を下げる
- クライアント側のデータ取得は必要最小限にし、連鎖する `useEffect` を避ける
- 再レンダリングの抑制を意識し、状態の粒度とコンポーネント分割を見直す
- 描画コストが高い UI は分割・遅延読み込みで段階的に表示する
- JS の処理量（ループ・計算）を減らし、同じリストを複数回走査しない
- 低効果の最適化（過剰な `useMemo`/`useCallback`）は後回しにする

### 追加ルール

- 原則として `for` / `for...of` / `for...in` は使用しない（コレクション操作や `reduce` などで表現する）
- 原則として `unknown` を型注釈として使用しない（必要ならジェネリクス + 型ガードで吸収する）
- 原則として `any` は使用しない（テスト/実装ともに型注釈・型アサーションで禁止）。代替: 適切な型定義・ジェネリクス・型ガード・`satisfies`・（テストの不正値注入は）より狭い union への型アサーションを使う
- マジックナンバー（例: 文字数制限、ページサイズ、桁数など）は直書きせず、定数として切り出して命名する
- メソッド内で直接 `if` を連打しない（原則として `if` は1回まで）。複数の条件分岐/バリデーションはガード関数・検証関数へ切り出す
- router（プレゼンテーション層）にバリデーションロジック（条件分岐やメッセージ判定）を書かない
- 入出力のバリデーションは `packages/shared` の Zod スキーマ（`.input(...)` / `.output(...)`）に責務を寄せる
- ビジネスロジックの失敗はユースケースで表現し、Result 型（Effect/TaggedError などの型付きエラー）として返す／throw する

### 命名規則

- コンポーネント: PascalCase（例: `UserProfile.tsx`）
- 関数・変数: camelCase（例: `getUserData`）
- 定数: UPPER_SNAKE_CASE（例: `MAX_RETRY_COUNT`）
- ファイル名: kebab-case または PascalCase（コンポーネントのみ）

## レビュー時の注意点

### 建設的なフィードバック

- 問題点を指摘するだけでなく、改善案も提示してください
- 重要度（Critical / Major / Minor）を明示してください
- 可能であればコード例を提示してください

### ポジティブなフィードバック

- 良い実装や改善点についても積極的にコメントしてください
- チームの学習と成長を促進するフィードバックを心がけてください

## 例外ケース

- WIP（Work In Progress）の PR には詳細なレビューは不要
- 自動生成されたファイル（`package-lock.json`など）は基本的にスキップ
- ドキュメントのみの変更は内容の正確性と分かりやすさを重視
